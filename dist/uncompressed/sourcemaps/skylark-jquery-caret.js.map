{"version":3,"sources":["skylark-jquery-caret.js"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"../skylark-jquery-caret.js","sourcesContent":["define('skylark-jquery-caret/caret',[\"skylark-jquery\"],function($){\n\n    var _input = document.createElement('input');\n\n    var _support = {\n        setSelectionRange: ('setSelectionRange' in _input) || ('selectionStart' in _input),\n        createTextRange: ('createTextRange' in _input) || ('selection' in document)\n    };\n\n    var _rNewlineIE = /\\r\\n/g,\n        _rCarriageReturn = /\\r/g;\n\n    var _getValue = function(input) {\n        if (typeof(input.value) !== 'undefined') {\n            return input.value;\n        }\n        return $(input).text();\n    };\n\n    var _setValue = function(input, value) {\n        if (typeof(input.value) !== 'undefined') {\n            input.value = value;\n        } else {\n            $(input).text(value);\n        }\n    };\n\n    var _getIndex = function(input, pos) {\n        var norm = _getValue(input).replace(_rCarriageReturn, '');\n        var len = norm.length;\n\n        if (typeof(pos) === 'undefined') {\n            pos = len;\n        }\n\n        pos = Math.floor(pos);\n\n        // Negative index counts backward from the end of the input/textarea's value\n        if (pos < 0) {\n            pos = len + pos;\n        }\n\n        // Enforce boundaries\n        if (pos < 0) { pos = 0; }\n        if (pos > len) { pos = len; }\n\n        return pos;\n    };\n\n    var _hasAttr = function(input, attrName) {\n        return input.hasAttribute ? input.hasAttribute(attrName) : (typeof(input[attrName]) !== 'undefined');\n    };\n\n    /**\n     * @class\n     * @constructor\n     */\n    var Range = function(start, end, length, text) {\n        this.start = start || 0;\n        this.end = end || 0;\n        this.length = length || 0;\n        this.text = text || '';\n    };\n\n    Range.prototype.toString = function() {\n        return JSON.stringify(this, null, '    ');\n    };\n\n    var _getCaretW3 = function(input) {\n        return input.selectionStart;\n    };\n\n    /**\n     * @see http://stackoverflow.com/q/6943000/467582\n     */\n    var _getCaretIE = function(input) {\n        var caret, range, textInputRange, rawValue, len, endRange;\n\n        // Yeah, you have to focus twice for IE 7 and 8.  *cries*\n        input.focus();\n        input.focus();\n\n        range = document.selection.createRange();\n\n        if (range && range.parentElement() === input) {\n            rawValue = _getValue(input);\n\n            len = rawValue.length;\n\n            // Create a working TextRange that lives only in the input\n            textInputRange = input.createTextRange();\n            textInputRange.moveToBookmark(range.getBookmark());\n\n            // Check if the start and end of the selection are at the very end\n            // of the input, since moveStart/moveEnd doesn't return what we want\n            // in those cases\n            endRange = input.createTextRange();\n            endRange.collapse(false);\n\n            if (textInputRange.compareEndPoints(\"StartToEnd\", endRange) > -1) {\n                caret = rawValue.replace(_rNewlineIE, '\\n').length;\n            } else {\n                caret = -textInputRange.moveStart(\"character\", -len);\n            }\n\n            return caret;\n        }\n\n        // NOTE: This occurs when you highlight part of a textarea and then click in the middle of the highlighted portion in IE 6-10.\n        //       There doesn't appear to be anything we can do about it.\n//        alert(\"Your browser is incredibly stupid.  I don't know what else to say.\");\n//        alert(range + '\\n\\n' + range.parentElement().tagName + '#' + range.parentElement().id);\n\n        return 0;\n    };\n\n    /**\n     * Gets the position of the caret in the given input.\n     * @param {HTMLInputElement|HTMLTextAreaElement} input input or textarea element\n     * @returns {Number}\n     * @see http://stackoverflow.com/questions/263743/how-to-get-cursor-position-in-textarea/263796#263796\n     */\n    var _getCaret = function(input) {\n        if (!input) {\n            return undefined;\n        }\n\n        // Mozilla, et al.\n        if (_support.setSelectionRange) {\n            return _getCaretW3(input);\n        }\n        // IE\n        else if (_support.createTextRange) {\n            return _getCaretIE(input);\n        }\n\n        return undefined;\n    };\n\n    var _setCaretW3 = function(input, pos) {\n        input.setSelectionRange(pos, pos);\n    };\n\n    var _setCaretIE = function(input, pos) {\n        var range = input.createTextRange();\n        range.move('character', pos);\n        range.select();\n    };\n\n    /**\n     * Sets the position of the caret in the given input.\n     * @param {HTMLInputElement|HTMLTextAreaElement} input input or textarea element\n     * @param {Number} pos\n     * @see http://parentnode.org/javascript/working-with-the-cursor-position/\n     */\n    var _setCaret = function(input, pos) {\n        input.focus();\n\n        pos = _getIndex(input, pos);\n\n        // Mozilla, et al.\n        if (_support.setSelectionRange) {\n            _setCaretW3(input, pos);\n        }\n        // IE\n        else if (_support.createTextRange) {\n            _setCaretIE(input, pos);\n        }\n    };\n\n    /**\n     * Inserts the specified text at the current caret position in the given input.\n     * @param {HTMLInputElement|HTMLTextAreaElement} input input or textarea element\n     * @param {String} text\n     * @see http://parentnode.org/javascript/working-with-the-cursor-position/\n     */\n    var _insertAtCaret = function(input, text) {\n        var curPos = _getCaret(input);\n\n        var oldValueNorm = _getValue(input).replace(_rCarriageReturn, '');\n\n        var newLength = +(curPos + text.length + (oldValueNorm.length - curPos));\n        var maxLength = +input.getAttribute('maxlength');\n\n        if(_hasAttr(input, 'maxlength') && newLength > maxLength) {\n            var delta = text.length - (newLength - maxLength);\n            text = text.substr(0, delta);\n        }\n\n        _setValue(input, oldValueNorm.substr(0, curPos) + text + oldValueNorm.substr(curPos));\n\n        _setCaret(input, curPos + text.length);\n    };\n\n    var _getInputRangeW3 = function(input) {\n        var range = new Range();\n\n        range.start = input.selectionStart;\n        range.end = input.selectionEnd;\n\n        var min = Math.min(range.start, range.end);\n        var max = Math.max(range.start, range.end);\n\n        range.length = max - min;\n        range.text = _getValue(input).substring(min, max);\n\n        return range;\n    };\n\n    /** @see http://stackoverflow.com/a/3648244/467582 */\n    var _getInputRangeIE = function(input) {\n        var range = new Range();\n\n        input.focus();\n\n        var selection = document.selection.createRange();\n\n        if (selection && selection.parentElement() === input) {\n            var len, normalizedValue, textInputRange, endRange, start = 0, end = 0;\n            var rawValue = _getValue(input);\n\n            len = rawValue.length;\n            normalizedValue = rawValue.replace(/\\r\\n/g, \"\\n\");\n\n            // Create a working TextRange that lives only in the input\n            textInputRange = input.createTextRange();\n            textInputRange.moveToBookmark(selection.getBookmark());\n\n            // Check if the start and end of the selection are at the very end\n            // of the input, since moveStart/moveEnd doesn't return what we want\n            // in those cases\n            endRange = input.createTextRange();\n            endRange.collapse(false);\n\n            if (textInputRange.compareEndPoints(\"StartToEnd\", endRange) > -1) {\n                start = end = len;\n            } else {\n                start = -textInputRange.moveStart(\"character\", -len);\n                start += normalizedValue.slice(0, start).split(\"\\n\").length - 1;\n\n                if (textInputRange.compareEndPoints(\"EndToEnd\", endRange) > -1) {\n                    end = len;\n                } else {\n                    end = -textInputRange.moveEnd(\"character\", -len);\n                    end += normalizedValue.slice(0, end).split(\"\\n\").length - 1;\n                }\n            }\n\n            /// normalize newlines\n            start -= (rawValue.substring(0, start).split('\\r\\n').length - 1);\n            end -= (rawValue.substring(0, end).split('\\r\\n').length - 1);\n            /// normalize newlines\n\n            range.start = start;\n            range.end = end;\n            range.length = range.end - range.start;\n            range.text = normalizedValue.substr(range.start, range.length);\n        }\n\n        return range;\n    };\n\n    /**\n     * Gets the selected text range of the given input.\n     * @param {HTMLInputElement|HTMLTextAreaElement} input input or textarea element\n     * @returns {Range}\n     * @see http://stackoverflow.com/a/263796/467582\n     * @see http://stackoverflow.com/a/2966703/467582\n     */\n    var _getInputRange = function(input) {\n        if (!input) {\n            return undefined;\n        }\n\n        // Mozilla, et al.\n        if (_support.setSelectionRange) {\n            return _getInputRangeW3(input);\n        }\n        // IE\n        else if (_support.createTextRange) {\n            return _getInputRangeIE(input);\n        }\n\n        return undefined;\n    };\n\n    var _setInputRangeW3 = function(input, startPos, endPos) {\n        input.setSelectionRange(startPos, endPos);\n    };\n\n    var _setInputRangeIE = function(input, startPos, endPos) {\n        var tr = input.createTextRange();\n        tr.moveEnd('textedit', -1);\n        tr.moveStart('character', startPos);\n        tr.moveEnd('character', endPos - startPos);\n        tr.select();\n    };\n\n    /**\n     * Sets the selected text range of (i.e., highlights text in) the given input.\n     * @param {HTMLInputElement|HTMLTextAreaElement} input input or textarea element\n     * @param {Number} startPos Zero-based index\n     * @param {Number} endPos Zero-based index\n     * @see http://parentnode.org/javascript/working-with-the-cursor-position/\n     * @see http://stackoverflow.com/a/2966703/467582\n     */\n    var _setInputRange = function(input, startPos, endPos) {\n        startPos = _getIndex(input, startPos);\n        endPos = _getIndex(input, endPos);\n\n        // Mozilla, et al.\n        if (_support.setSelectionRange) {\n            _setInputRangeW3(input, startPos, endPos);\n        }\n        // IE\n        else if (_support.createTextRange) {\n            _setInputRangeIE(input, startPos, endPos);\n        }\n    };\n\n    /**\n     * Replaces the currently selected text with the given string.\n     * @param {HTMLInputElement|HTMLTextAreaElement} input input or textarea element\n     * @param {String} text New text that will replace the currently selected text.\n     * @see http://parentnode.org/javascript/working-with-the-cursor-position/\n     */\n    var _replaceInputRange = function(input, text) {\n        var $input = $(input);\n\n        var oldValue = $input.val();\n        var selection = _getInputRange(input);\n\n        var newLength = +(selection.start + text.length + (oldValue.length - selection.end));\n        var maxLength = +$input.attr('maxlength');\n\n        if($input.is('[maxlength]') && newLength > maxLength) {\n            var delta = text.length - (newLength - maxLength);\n            text = text.substr(0, delta);\n        }\n\n        // Now that we know what the user selected, we can replace it\n        var startText = oldValue.substr(0, selection.start);\n        var endText = oldValue.substr(selection.end);\n\n        $input.val(startText + text + endText);\n\n        // Reset the selection\n        var startPos = selection.start;\n        var endPos = startPos + text.length;\n\n        _setInputRange(input, selection.length ? startPos : endPos, endPos);\n    };\n\n    var _selectAllW3 = function(elem) {\n        var selection = window.getSelection();\n        var range = document.createRange();\n        range.selectNodeContents(elem);\n        selection.removeAllRanges();\n        selection.addRange(range);\n    };\n\n    var _selectAllIE = function(elem) {\n        var range = document.body.createTextRange();\n        range.moveToElementText(elem);\n        range.select();\n    };\n\n    /**\n     * Select all text in the given element.\n     * @param {HTMLElement} elem Any block or inline element other than a form element.\n     */\n    var _selectAll = function(elem) {\n        var $elem = $(elem);\n        if ($elem.is('input, textarea') || elem.select) {\n            $elem.select();\n            return;\n        }\n\n        // Mozilla, et al.\n        if (_support.setSelectionRange) {\n            _selectAllW3(elem);\n        }\n        // IE\n        else if (_support.createTextRange) {\n            _selectAllIE(elem);\n        }\n    };\n\n    var _deselectAll = function() {\n        if (document.selection) {\n            document.selection.empty();\n        }\n        else if (window.getSelection) {\n            window.getSelection().removeAllRanges();\n        }\n    };\n\n    $.extend($.fn, {\n\n        /**\n         * Gets or sets the position of the caret or inserts text at the current caret position in an input or textarea element.\n         * @returns {Number|jQuery} The current caret position if invoked as a getter (with no arguments)\n         * or this jQuery object if invoked as a setter or inserter.\n         * @see http://web.archive.org/web/20080704185920/http://parentnode.org/javascript/working-with-the-cursor-position/\n         * @since 1.0.0\n         * @example\n         * <pre>\n         *    // Get position\n         *    var pos = $('input:first').caret();\n         * </pre>\n         * @example\n         * <pre>\n         *    // Set position\n         *    $('input:first').caret(15);\n         *    $('input:first').caret(-3);\n         * </pre>\n         * @example\n         * <pre>\n         *    // Insert text at current position\n         *    $('input:first').caret('Some text');\n         * </pre>\n         */\n        caret: function() {\n            var $inputs = this.filter('input, textarea');\n\n            // getCaret()\n            if (arguments.length === 0) {\n                var input = $inputs.get(0);\n                return _getCaret(input);\n            }\n            // setCaret(position)\n            else if (typeof arguments[0] === 'number') {\n                var pos = arguments[0];\n                $inputs.each(function(_i, input) {\n                    _setCaret(input, pos);\n                });\n            }\n            // insertAtCaret(text)\n            else {\n                var text = arguments[0];\n                $inputs.each(function(_i, input) {\n                    _insertAtCaret(input, text);\n                });\n            }\n\n            return this;\n        },\n\n        /**\n         * Gets or sets the selection range or replaces the currently selected text in an input or textarea element.\n         * @returns {Range|jQuery} The current selection range if invoked as a getter (with no arguments)\n         * or this jQuery object if invoked as a setter or replacer.\n         * @see http://stackoverflow.com/a/2966703/467582\n         * @since 1.0.0\n         * @example\n         * <pre>\n         *    // Get selection range\n         *    var range = $('input:first').range();\n         * </pre>\n         * @example\n         * <pre>\n         *    // Set selection range\n         *    $('input:first').range(15);\n         *    $('input:first').range(15, 20);\n         *    $('input:first').range(-3);\n         *    $('input:first').range(-8, -3);\n         * </pre>\n         * @example\n         * <pre>\n         *    // Replace the currently selected text\n         *    $('input:first').range('Replacement text');\n         * </pre>\n         */\n        range: function() {\n            var $inputs = this.filter('input, textarea');\n\n            // getRange() = { start: pos, end: pos }\n            if (arguments.length === 0) {\n                var input = $inputs.get(0);\n                return _getInputRange(input);\n            }\n            // setRange(startPos, endPos)\n            else if (typeof arguments[0] === 'number') {\n                var startPos = arguments[0];\n                var endPos = arguments[1];\n                $inputs.each(function(_i, input) {\n                    _setInputRange(input, startPos, endPos);\n                });\n            }\n            // replaceRange(text)\n            else {\n                var text = arguments[0];\n                $inputs.each(function(_i, input) {\n                    _replaceInputRange(input, text);\n                });\n            }\n\n            return this;\n        },\n\n        /**\n         * Selects all text in each element of this jQuery object.\n         * @returns {jQuery} This jQuery object\n         * @see http://stackoverflow.com/a/11128179/467582\n         * @since 1.5.0\n         * @example\n         * <pre>\n         *     // Select the contents of span elements when clicked\n         *     $('span').on('click', function() { $(this).highlight(); });\n         * </pre>\n         */\n        selectAll: function() {\n            return this.each(function(_i, elem) {\n                _selectAll(elem);\n            });\n        }\n\n    });\n\n    $.extend($, {\n        /**\n         * Deselects all text on the page.\n         * @returns {jQuery} The jQuery function\n         * @since 1.5.0\n         * @example\n         * <pre>\n         *     // Select some text\n         *     $('span').selectAll();\n         *\n         *     // Deselect the text\n         *     $.deselectAll();\n         * </pre>\n         */\n        deselectAll: function() {\n            _deselectAll();\n            return this;\n        }\n    });\n\n    return $;\n});\ndefine('skylark-jquery-caret/main',[\"./caret\"],function($){\r\n\treturn $;\r\n});\ndefine('skylark-jquery-caret', ['skylark-jquery-caret/main'], function (main) { return main; });\n\n"]}